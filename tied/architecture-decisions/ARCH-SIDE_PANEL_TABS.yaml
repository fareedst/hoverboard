# [ARCH-SIDE_PANEL_TABS] [REQ-SIDE_PANEL_POPUP_EQUIVALENT] [REQ-SIDE_PANEL_TAGS_TREE]
# Architecture: Single side panel page with tab bar; two content panels (Bookmark, Tags tree);
# reuse popup stack for Bookmark with scoped root; Tags tree as second tab.

ARCH-SIDE_PANEL_TABS:
  name: Side Panel Tabs Architecture
  status: Active
  cross_references:
    - REQ-SIDE_PANEL_POPUP_EQUIVALENT
    - REQ-SIDE_PANEL_TAGS_TREE
  rationale:
    why: One panel page avoids multiple default_path entries; tabs let users switch between popup-equivalent and tags tree without losing context.
    problems_solved:
      - Side panel showed only tags tree; no popup-equivalent in panel
      - Duplicate global IDs if both UIs were in the same document
    benefits:
      - Single panel entry (e.g. side-panel.html); tab bar; Bookmark panel uses UIManager/PopupController with scoped root (container) so element lookup is under that root; Tags tree panel hosts existing tags-tree UI
      - Only one panel visible at a time; last-selected tab persisted
  implementation_approach:
    summary: Manifest side_panel.default_path points to one HTML (side-panel.html). Page has tab bar ("Bookmark" | "Tags tree"), #bookmarkPanel (root for popup-equivalent with data-popup-ref attributes), #tagsTreePanel (existing tags-tree content). When Bookmark tab is selected, init UISystem and createPopup({ container: bookmarkPanel }), loadInitialData, setupEventListeners. When Tags tree tab is selected, run tags-tree load/render. Persist selected tab in chrome.storage.local.
    details:
      - Tab bar: two buttons or links; click switches visible panel and persists choice
      - UIManager must support optional container; when set, cacheElements uses container.querySelector('[data-popup-ref="id"]') instead of document.getElementById
      - Bookmark panel markup: same structure as popup main (loading, error, main with quick actions, storage, tag management, search) with data-popup-ref on each element
      - Tags tree panel: current tags-tree sections (config, search, tag selector, tree); IDs remain unique in document
      - "Open Tags tree" in Bookmark footer: in panel context, switch to Tags tree tab instead of sending OPEN_SIDE_PANEL
      - Layout: Page and tab content use full viewport height and panel width. Override popup-derived body constraints (max-height, width) when in side panel. Tab content area is a flex column so children can distribute space. Tags tree panel fills the content area with a single scrollable tree section.
  traceability:
    requirements:
      - REQ-SIDE_PANEL_POPUP_EQUIVALENT
      - REQ-SIDE_PANEL_TAGS_TREE
    implementation:
      - IMPL-SIDE_PANEL_TABS
      - IMPL-SIDE_PANEL_BOOKMARK
      - IMPL-UIManager_SCOPED_ROOT
    tests:
      - tests/unit/ui-manager-scoped-root.test.js
      - tests/unit/side-panel-tabs.test.js
      - tests/playwright/extension-messaging.spec.js
    code_annotations:
      - ARCH-SIDE_PANEL_TABS
  related_decisions:
    depends_on:
      - REQ-SIDE_PANEL_POPUP_EQUIVALENT
      - REQ-SIDE_PANEL_TAGS_TREE
    informs:
      - IMPL-SIDE_PANEL_TABS
      - IMPL-SIDE_PANEL_BOOKMARK
      - IMPL-UIManager_SCOPED_ROOT
    see_also:
      - ARCH-SIDE_PANEL_TAGS_TREE
      - ARCH-EXTENSION_BUNDLED_ENTRY_POINTS
  detail_file: architecture-decisions/ARCH-SIDE_PANEL_TABS.yaml
  metadata:
    created:
      date: '2026-02-25'
      author: AI Agent
    last_updated:
      date: '2026-02-25'
      author: AI Agent
      reason: Add layout detail (full viewport height/width; tab content flex; Tags tree scrollable section)
