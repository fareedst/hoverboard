ARCH-EXTENSION_BUNDLED_ENTRY_POINTS:
  name: Extension Bundled Entry Points
  status: Active
  cross_references:
    - REQ-EXTENSION_BUNDLED_ENTRY_POINTS
    - IMPL-POPUP_BUNDLE
  rationale:
    why: Browsers do not resolve Node-style bare module specifiers; extension scripts loaded by the browser (service worker, popup, options, content script) must be self-contained bundles
    problems_solved:
      - "Failed to resolve module specifier 'fast-xml-parser'" when popup loaded unbundled code that eventually imported pinboard-service.js (which imports fast-xml-parser)
      - Any entry point that loads raw source files with npm imports would fail at runtime
    benefits:
      - All four entry points are built with esbuild; npm dependencies (e.g. fast-xml-parser) are inlined
      - Build copy step skips entry files so the bundled output is what the extension loads
  implementation_approach:
    summary: Build script runs build:sw, build:options, build:content, build:popup; copyDir from src to dist skips service-worker.js, options.js, content-main.js, popup.js so bundled versions are used
    details:
      - Service worker and options were already bundled; content script already bundled
      - Popup was previously copied raw; popup's dependency chain (e.g. TagService → PinboardService → fast-xml-parser) caused failure when popup opened; add build:popup and skip copying popup.js
  traceability:
    requirements:
      - REQ-EXTENSION_BUNDLED_ENTRY_POINTS
    implementation:
      - IMPL-POPUP_BUNDLE
  detail_file: architecture-decisions/ARCH-EXTENSION_BUNDLED_ENTRY_POINTS.yaml
  metadata:
    created: "2026-02-17"
    last_updated: "2026-02-17"
    author: AI Agent
