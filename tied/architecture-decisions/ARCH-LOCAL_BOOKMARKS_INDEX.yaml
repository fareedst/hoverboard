ARCH-LOCAL_BOOKMARKS_INDEX:
  name: Local Bookmarks Index Architecture
  status: Active
  cross_references: &ref_0 []
  rationale:
    why: See detail file
    problems_solved: []
    benefits: []
  alternatives_considered: []
  implementation_approach:
    summary: 'A **single extension page** (e.g. `bookmarks-table.html`) displays a table of **local, file, and sync bookmarks** (non-Pinboard). The primary data source is message **getAggregatedBookmarksForIndex**, which returns bookmarks from LocalBookmarkService, FileBookmarkService, and SyncBookmarkService (via BookmarkRouter.getAllBookmarksForIndex), each item tagged with `storage: ''local''` | ''file'' | ''sync''. Fallback: **getLocalBookmarksForIndex** (LocalBookmarkService only, all items `storage: ''local''`) when the router is not used. The table includes a **Select** column (checkboxes, select-all), **Storage** column (Local | File | Sync), **Storage type filter** (All | Local | File | Sync), **Time column** toggle (Create time | Last updated) and **Time format** toggle (Absolute | Age), **search** (single input over title, URL, tags, notes), **filters** (by tag, to-read, private), **sortable columns** (including Storage and Time; default: time descending; sort by Time uses selected time source), **launchable URLs** with **external-link indicator** (opens in new tab), and **Move selected to** (Local | File | Sync) with move controls enabled only when selection is non-empty. When there are no local, file, or sync bookmarks, an empty state is shown.'
    details: []
  traceability:
    requirements: *ref_0
    implementation: []
    tests: []
    code_annotations:
      - ARCH-LOCAL_BOOKMARKS_INDEX
  related_decisions:
    depends_on: *ref_0
    informs: []
    see_also: []
  detail_file: architecture-decisions/ARCH-LOCAL_BOOKMARKS_INDEX.yaml
  metadata:
    created:
      date: '2026-02-18'
      author: MCP converter
    last_updated:
      date: '2026-02-18'
      author: MCP converter
      reason: Converted from monolithic
    last_validated:
      date: '2026-02-18'
      validator: MCP converter
      result: pass
  decision: 'A **single extension page** (e.g. `bookmarks-table.html`) displays a table of **local, file, and sync bookmarks** (non-Pinboard). The primary data source is message **getAggregatedBookmarksForIndex**, which returns bookmarks from LocalBookmarkService, FileBookmarkService, and SyncBookmarkService (via BookmarkRouter.getAllBookmarksForIndex), each item tagged with `storage: ''local''` | ''file'' | ''sync''. Fallback: **getLocalBookmarksForIndex** (LocalBookmarkService only, all items `storage: ''local''`) when the router is not used. The table includes a **Select** column (checkboxes, select-all), **Storage** column (Local | File | Sync), **Storage type filter** (All | Local | File | Sync), **Time column** toggle (Create time | Last updated) and **Time format** toggle (Absolute | Age) for a single **Time** column [REQ-BOOKMARK_CREATE_UPDATE_TIMES], **search** (single input over title, URL, tags, notes), **filters** (by tag, to-read, private), **sortable columns** (including Storage and Time; default: time descending; sort by Time uses the selected time source), **launchable URLs** with **external-link indicator** (opens in new tab), and **Move selected to** (Local | File | Sync) with move controls enabled only when selection is non-empty. When there are no local, file, or sync bookmarks, an empty state is shown.'
  cross-references: REQ-LOCAL_BOOKMARKS_INDEX, IMPL-LOCAL_BOOKMARKS_INDEX, ARCH-STORAGE_INDEX_AND_ROUTER
  filters: 'By tag (include), "To read" only (toread === ''yes''), "Private" only (shared === ''no''), **Storage type** (All | Local | File | Sync). Combined with search; all client-side.'
  getaggregatedbookmarksforindex: 'Handled by calling `bookmarkProvider.getAllBookmarksForIndex()` when the provider is BookmarkRouter; router aggregates local, file, and sync providers, adds `storage: ''local''` | ''file'' | ''sync'', merges and sorts by time desc.'
  getlocalbookmarksforindex: 'Fallback when aggregated is unavailable; uses LocalBookmarkService directly, returns local bookmarks only (index page tags each with `storage: ''local''`).'
  launch: 'URL column is `<a href="..." target="_blank" rel="noopener">` with **external-link indicator** (e.g. â†—) and title "Opens in new tab".'
  selection: 'First column **Select**: checkboxes per row, header "select all" for visible rows. Selected URLs kept in a Set for bulk operations.'
  bulk_move: '**Move selected to** (Local | File | Sync) + Move button; uses existing moveBookmarkToStorage message per selected URL [REQ-MOVE_BOOKMARK_STORAGE_UI]. Move controls disabled when no selection; enabled when one or more bookmarks selected.'
  related:
    - IMPL-LOCAL_BOOKMARKS_INDEX (getAggregatedBookmarksForIndex / getLocalBookmarksForIndex, handler, bookmarks-table UI with Storage column)
    - ARCH-STORAGE_INDEX_AND_ROUTER (BookmarkRouter, getAllBookmarksForIndex)
    - ARCH-LOCAL_STORAGE_PROVIDER (LocalBookmarkService strategy)
    - ARCH-MESSAGE_HANDLING (message routing)
  search: One text input; case-insensitive substring match on description, url, tags (joined), extended.
  sort: 'Click column header to sort; toggle asc/desc. Columns: **Select**, Title, URL, Tags, Time, **Storage** (Local | File | Sync), Shared, To read. Default sort: time descending. When sorting by Time, the effective key is the selected time source (create-time or last-updated).'
  time_column: 'Single **Time** column; toolbar toggles: **Time column** (Create time | Last updated) and **Time format** (Absolute: YYYY-MM-DD HH:mm:ss | Age: two largest units, e.g. N days O hours). [REQ-BOOKMARK_CREATE_UPDATE_TIMES].'
  summary: 'A **single extension page** (e.g. `bookmarks-table.html`) displays a table of **local, file, and sync bookmarks** (non-Pinboard). The primary data source is message **getAggregatedBookmarksForIndex**, which returns bookmarks from LocalBookmarkService, FileBookmarkService, and SyncBookmarkService (via BookmarkRouter.getAllBookmarksForIndex), each item tagged with `storage: ''local''` | ''file'' | ''sync''. Fallback: **getLocalBookmarksForIndex** (LocalBookmarkService only, all items `storage: ''local''`) when the router is not used. The table includes a **Select** column (checkboxes, select-all), **Storage** column (Local | File | Sync), **Storage type filter** (All | Local | File | Sync), **Time column** and **Time format** toggles (create vs last updated; absolute vs age), **search** (single input over title, URL, tags, notes), **filters** (by tag, to-read, private), **sortable columns** (including Storage and Time; default: time descending), **launchable URLs** with **external-link indicator** (opens in new tab), and **Move selected to** (Local | File | Sync) with move controls enabled only when selection is non-empty. When there are no local, file, or sync bookmarks, an empty state is shown.'
