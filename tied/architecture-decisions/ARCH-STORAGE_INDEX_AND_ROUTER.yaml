ARCH-STORAGE_INDEX_AND_ROUTER:
  name: Storage Index and Bookmark Router
  status: Active
  cross_references: &ref_0 []
  rationale:
    why: |-
      Single global provider cannot support per-bookmark storage; routing by URL enables move and default for new bookmarks.
      Default storage mode (config) extended to include 'file'; migration seeds index from existing local bookmarks.
    problems_solved: []
    benefits: []
  alternatives_considered: []
  implementation_approach:
    summary: A **storage index** in chrome.storage.local maps each bookmark URL to its backend (`pinboard` | `local` | `file`). The **BookmarkRouter** holds references to all three providers and delegates getBookmarkForUrl, saveBookmark, deleteBookmark, saveTag, deleteTag to the provider indicated by the index (or the default storage mode for new bookmarks). getRecentBookmarks aggregates results from all three providers and returns a single list sorted by time. MessageHandler uses the router as its bookmark provider (duck-typed).
    details: []
  traceability:
    requirements: *ref_0
    implementation: []
    tests: []
    code_annotations:
      - ARCH-STORAGE_INDEX_AND_ROUTER
  related_decisions:
    depends_on: *ref_0
    informs: []
    see_also: []
  detail_file: architecture-decisions/ARCH-STORAGE_INDEX_AND_ROUTER.yaml
  metadata:
    created:
      date: '2026-02-18'
      author: MCP converter
    last_updated:
      date: '2026-02-18'
      author: MCP converter
      reason: Converted from monolithic
    last_validated:
      date: '2026-02-18'
      validator: MCP converter
      result: pass
  decision: A **storage index** in chrome.storage.local maps each bookmark URL to its backend (`pinboard` | `local` | `file`). The **BookmarkRouter** holds references to all three providers and delegates getBookmarkForUrl, saveBookmark, deleteBookmark, saveTag, deleteTag to the provider indicated by the index (or the default storage mode for new bookmarks). getRecentBookmarks aggregates results from all three providers and returns a single list sorted by time. MessageHandler uses the router as its bookmark provider (duck-typed).
  cross-references: REQ-PER_BOOKMARK_STORAGE_BACKEND, ARCH-LOCAL_STORAGE_PROVIDER, ARCH-FILE_BOOKMARK_PROVIDER, IMPL-STORAGE_INDEX, IMPL-BOOKMARK_ROUTER
  related:
    - IMPL-STORAGE_INDEX, IMPL-BOOKMARK_ROUTER
    - ARCH-MOVE_BOOKMARK_UI (move = copy + delete + index update)
  summary: A **storage index** in chrome.storage.local maps each bookmark URL to its backend (`pinboard` | `local` | `file`). The **BookmarkRouter** holds references to all three providers and delegates getBookmarkForUrl, saveBookmark, deleteBookmark, saveTag, deleteTag to the provider indicated by the index (or the default storage mode for new bookmarks). getRecentBookmarks aggregates results from all three providers and returns a single list sorted by time. MessageHandler uses the router as its bookmark provider (duck-typed).
