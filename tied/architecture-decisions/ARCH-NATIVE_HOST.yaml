ARCH-NATIVE_HOST:
  name: Native Host Architecture
  status: Active
  cross_references: &ref_0
    - REQ-NATIVE_HOST_WRAPPER
  rationale:
    why: |-
      Chrome does not pass the extension path to the host; the host cannot safely load from the extension folder. Installing to a fixed path and having the wrapper load only from its own directory satisfies the constraint while still allowing “extension-distributed” code to be used after install.
      Go for the wrapper: single codebase, one binary per OS, no runtime dependency, easy stdio and subprocess handling.
      User-level install path by default (`~/.hoverboard/`, `%LOCALAPPDATA%\Hoverboard\`) avoids requiring admin rights.
    problems_solved: []
    benefits: []
  alternatives_considered: []
  implementation_approach:
    summary: 'The native messaging host is implemented as a **thin wrapper** plus **helper** plus **installer**:'
    details: []
  traceability:
    requirements: *ref_0
    implementation: []
    tests: []
    code_annotations:
      - ARCH-NATIVE_HOST
      - REQ-NATIVE_HOST_WRAPPER
  related_decisions:
    depends_on: *ref_0
    informs: []
    see_also: []
  detail_file: architecture-decisions/ARCH-NATIVE_HOST.yaml
  metadata:
    created:
      date: '2026-02-18'
      author: MCP converter
    last_updated:
      date: '2026-02-18'
      author: MCP converter
      reason: Converted from monolithic
    last_validated:
      date: '2026-02-18'
      validator: MCP converter
      result: pass
  decision: 'The native messaging host is implemented as a **thin wrapper** plus **helper** plus **installer**:'
  helper: 'Minimal script or binary in the same directory as the wrapper (e.g. `helper.sh`, `helper.ps1`, or `helper.exe`). Contract: read JSON from stdin, write JSON to stdout. Installed by the installer next to the wrapper.'
  implementation: '[IMPL-NATIVE_HOST_WRAPPER](../implementation-decisions/IMPL-NATIVE_HOST_WRAPPER.md), [IMPL-NATIVE_HOST_INSTALLER](../implementation-decisions/IMPL-NATIVE_HOST_INSTALLER.md)'
  installer: 'Script(s) that copy wrapper and helper from a source dir (e.g. unpacked extension or build output) to a fixed install path, generate the native messaging manifest with absolute path and `allowed_origins` from the extension ID, and write the manifest to the platform-specific location (macOS/Linux: `NativeMessagingHosts/` under user profile; Windows: manifest path + registry key).'
  requirements: '[REQ-NATIVE_HOST_WRAPPER](../requirements/REQ-NATIVE_HOST_WRAPPER.md)'
  wrapper: Single binary (Go) that speaks the Chrome native messaging protocol (stdio, 4-byte length + JSON). It resolves its install directory from `os.Executable()`, never uses the extension path. For each message it either responds to `ping` with `pong` or invokes a **helper** in the same directory (script or binary) and returns the helper’s JSON response; if no helper is present, it echoes the request or returns pong.
