IMPL-PINBOARD_POSTS_ADD_ENCODING:
  name: Pinboard posts/add query parameter encoding
  status: Active
  cross_references:
    - IMPL-PINBOARD_API
    - IMPL-TAG_SYSTEM
  rationale:
    why: Store-tag API failed when tags contained #, +, . because URL was not safely encoded; unencoded # starts fragment so server may not receive auth_token; unencoded + interpreted as space. Fix: explicit percent-encoding via encodeURIComponent for all posts/add params.
    problems_solved:
      - Broken API requests when tags or other fields contain #, +, ., &, =
    benefits: []
  implementation_approach:
    summary: buildSaveParams(bookmarkData) builds query string from key=encodeURIComponent(value) pairs joined by '&'; used for posts/add URL so encoding is guaranteed in all runtimes (extension and Safari).
    details: []
  code_locations:
    files:
      - path: src/features/pinboard/pinboard-service.js
        description: buildSaveParams
      - path: safari/src/features/pinboard/pinboard-service.js
        description: buildSaveParams
    functions:
      - name: buildSaveParams
        file: src/features/pinboard/pinboard-service.js
        description: Builds pairs with encodeURIComponent for url, description, extended, tags, shared, toread; returns pairs.join('&')
  traceability:
    architecture: []
    requirements: []
    tests:
      - tests/unit/tag-storage.test.js
    code_annotations:
      - IMPL-PINBOARD_POSTS_ADD_ENCODING
  related_decisions:
    depends_on: []
    supersedes: []
    see_also:
      - IMPL-PINBOARD_API
      - IMPL-TAG_SYSTEM
    composed_with:
      - IMPL-PINBOARD_API
      - IMPL-TAG_SYSTEM
  essence_pseudocode: |
    INPUT: bookmarkData (url, description, extended, tags, shared, toread)
    OUTPUT: query string safe for posts/add URL (no raw #, +, &, = in values)
    DATA: param names and values from bookmarkData

    buildSaveParams(bookmarkData):
      pairs = []
      FOR each key in [url, description, extended, tags, shared, toread]:
        value = bookmarkData[key] (or default)
        encoded = encodeURIComponent(value)
        pairs.push(key + "=" + encoded)
      RETURN pairs.join("&")

    usage: BUILD posts/add request URL as baseUrl + "?" + buildSaveParams(bookmarkData) so fragment and plus are not misinterpreted by server or transport.
  detail_file: implementation-decisions/IMPL-PINBOARD_POSTS_ADD_ENCODING.yaml
  metadata:
    created:
      date: '2026-02-18'
      author: MCP converter
    last_updated:
      date: '2026-02-20'
      author: AI Agent
      reason: Canonical YAML rewrite; add essence_pseudocode and composed_with; remove extraneous keys
    last_validated:
      date: '2026-02-18'
      validator: MCP converter
      result: pass
