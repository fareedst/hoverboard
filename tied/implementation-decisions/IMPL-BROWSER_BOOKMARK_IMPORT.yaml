IMPL-BROWSER_BOOKMARK_IMPORT:
  name: Browser Bookmark Import Implementation
  status: Active
  cross_references:
    - ARCH-BROWSER_BOOKMARK_IMPORT
    - REQ-BROWSER_BOOKMARK_IMPORT
  rationale:
    why: Implement browser bookmark import page with getTree, flatten, filters, selection, conflict resolution, tags, and saveBookmark loop.
    problems_solved:
      - No UI or logic for importing browser bookmarks into Hoverboard
    benefits:
      - browser-bookmark-import.html/.js/.css; getTree + flatten with folderPath; toolbar search + folder dropdown; table Select, Title, URL, Folder, Date; conflict radios (Skip / Overwrite / Merge); Use folder names as tags checkbox + Add tags input; Import to dropdown; Import button; getAggregatedBookmarksForIndex for existing set; merge uses existing record from that list; result span
  implementation_approach:
    summary: New directory src/ui/browser-bookmark-import/ with HTML (header, toolbar, table, actions-below-table), JS (imports from browser-bookmark-import-utils.js; loadBrowserBookmarks, applySearchAndFilter, renderTable, selection, runImport with conflict and tags), CSS (reuse design-tokens; mirror bookmarks-table layout). Entry: popup button + handler (handleOpenBrowserBookmarkImport must be bound in PopupController constructor) open tab; options footer link href.
    details:
      - browser-bookmark-import-utils.js: pure functions sanitizeTag, folderPathToTags, parseExtraTags, flattenTree for page and unit tests
      - flattenTree: recurse nodes; if node.url push { id, url, title, dateAdded, folderPath }; folderPath built from parent chain
      - Conflict: fetch getAggregatedBookmarksForIndex (or getLocalBookmarksForIndex); build existingByUrl map; for Merge, use existingByUrl[url] to merge description/extended/tags
      - Tag sanitization: folder path segments and extra tags → lowercase, replace non-alphanumeric with underscore, dedupe
      - Popup: handleOpenBrowserBookmarkImport bound in PopupController constructor (same as handleOpenBookmarksIndex) so event listener receives correct this
  code_locations:
    files:
      - src/ui/browser-bookmark-import/browser-bookmark-import.html
      - src/ui/browser-bookmark-import/browser-bookmark-import.js
      - src/ui/browser-bookmark-import/browser-bookmark-import.css
      - src/ui/browser-bookmark-import/browser-bookmark-import-utils.js
    functions:
      - flattenTree
      - loadBrowserBookmarks
      - runImport
      - sanitizeTag
      - folderPathToTags
      - parseExtraTags
  traceability:
    architecture:
      - ARCH-BROWSER_BOOKMARK_IMPORT
    requirements:
      - REQ-BROWSER_BOOKMARK_IMPORT
    tests:
      - tests/unit/browser-bookmark-import.test.js
    code_annotations:
      - IMPL-BROWSER_BOOKMARK_IMPORT
      - ARCH-BROWSER_BOOKMARK_IMPORT
      - REQ-BROWSER_BOOKMARK_IMPORT
  related_decisions:
    depends_on: []
    supersedes: []
    see_also:
      - IMPL-LOCAL_BOOKMARKS_INDEX
      - IMPL-LOCAL_BOOKMARKS_INDEX_IMPORT
  detail_file: implementation-decisions/IMPL-BROWSER_BOOKMARK_IMPORT.yaml
  metadata:
    created:
      date: '2026-02-18'
      author: AI Agent
    last_updated:
      date: '2026-02-18'
      author: AI Agent
      reason: New implementation for browser bookmark import page
    last_validated:
      date: '2026-02-18'
      validator: AI Agent
      result: pass
  annotations: Use [REQ-BROWSER_BOOKMARK_IMPORT], [ARCH-BROWSER_BOOKMARK_IMPORT], [IMPL-BROWSER_BOOKMARK_IMPORT] in HTML/JS comments.
  cross-references: ARCH-BROWSER_BOOKMARK_IMPORT, REQ-BROWSER_BOOKMARK_IMPORT
  logic: 'On load: chrome.bookmarks.getTree().then(flattenTree).then(store allBookmarks, build folder list, applySearchAndFilter). Search/folder filter client-side. Sort by column. Selection: Set of url (or id). Import: getAggregatedBookmarksForIndex → existingByUrl; for each selected build payload (description=title, time=dateAdded ISO, tags=folderTags+extra); if URL in existing: Skip→skip; Overwrite→send; Merge→merge tags + keep existing description/extended if set, then send. sendMessage saveBookmark per row; count imported/skipped/failed; show result.'
  ui: 'Header (logo, Hoverboard, Browser Bookmark Import, subtitle). Toolbar: search input, folder dropdown (All + unique folder paths). Table: Select, Title, URL, Folder path, Date added. Actions: conflict mode radios (Skip / Overwrite / Merge); "Use folder names as tags" checkbox; "Add tags (comma-separated)" input; Import to (Local | File | Sync); Import button; result span. Empty state if no permission or no bookmarks.'
  related:
    - IMPL-LOCAL_BOOKMARKS_INDEX (layout and table pattern)
    - ARCH-BROWSER_BOOKMARK_IMPORT, REQ-BROWSER_BOOKMARK_IMPORT
