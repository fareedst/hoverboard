IMPL-POPUP_THEME_CSS:
  name: Popup CSS honors ThemeManager (hb-theme-dark)
  status: Active
  cross_references:
    - REQ-DARK_THEME
    - ARCH-THEME
    - IMPL-SCREENSHOT_MODE
  rationale:
    why: Popup must reflect ThemeManager-applied theme so dark preference and screenshot seed (hoverboard_theme: 'dark') show dark popup
    problems_solved:
      - Popup stayed light when hoverboard_theme was 'dark' because popup.css only overrode variables in @media (prefers-color-scheme: dark), not when document root had class hb-theme-dark
    benefits:
      - Dark theme preference applies to popup; placeholder screenshots show dark popup when seed includes hoverboard_theme: 'dark'
  implementation_approach:
    summary: Add :root.hb-theme-dark block in popup.css with same dark variable values as the prefers-color-scheme media query
    details:
      - ThemeManager applies hb-theme-dark to document.documentElement and sets --hb-* variables; popup uses --bg-primary, --text-primary, etc. from popup.css
      - popup.css had no rule for :root.hb-theme-dark, so body stayed white; add :root.hb-theme-dark { --bg-primary: #1e1e1e; ... } so popup uses dark variables when ThemeManager sets dark
  code_locations:
    files:
      - path: src/ui/popup/popup.css
        description: ':root.hb-theme-dark block for popup dark theme'
    functions: []
  traceability:
    architecture:
      - ARCH-THEME
    requirements:
      - REQ-DARK_THEME
    tests:
      - tests/unit/dark-theme-default.test.js
    code_annotations:
      - IMPL-POPUP_THEME_CSS
  related_decisions:
    depends_on: []
    supersedes: []
    see_also:
      - IMPL-SCREENSHOT_MODE
    composed_with:
      - IMPL-SCREENSHOT_MODE
  essence_pseudocode: |
    INPUT: document.documentElement (root); ThemeManager sets hb-theme-dark and --hb-* vars
    OUTPUT: popup body uses dark background/text when theme is dark (same vars as prefers-color-scheme block)
    DATA: popup.css :root.hb-theme-dark { --bg-primary: #1e1e1e; --text-primary: ...; ... }

    Style resolution:
      IF root has class hb-theme-dark: APPLY :root.hb-theme-dark variables to popup
      ELSE IF prefers-color-scheme dark: APPLY @media (prefers-color-scheme: dark) variables
      ELSE: APPLY light variables
    Popup elements USE --bg-primary, --text-primary, etc. from resolved rule
  detail_file: implementation-decisions/IMPL-POPUP_THEME_CSS.yaml
  metadata:
    created:
      date: "2026-02-19"
      author: AI Agent
    last_updated:
      date: "2026-02-20"
      author: AI Agent
      reason: Add essence_pseudocode and complete composed_with
