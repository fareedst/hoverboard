IMPL-LOCAL_BOOKMARK_SERVICE:
  name: Local Bookmark Service
  status: Active
  cross_references:
    - REQ-STORAGE_MODE_DEFAULT
    - ARCH-LOCAL_STORAGE_PROVIDER
    - ARCH-STORAGE
  rationale:
    why: Implement bookmark provider contract using chrome.storage.local for local-only mode; no local storage existed before.
    problems_solved:
      - No implementation for storing bookmarks locally without the Pinboard API
    benefits:
      - Same provider contract as PinboardService; default storage mode is local; TagService integration for recent-tag tracking
      - Bookmarks keyed by URL in hoverboard_local_bookmarks; recent by time sort
  implementation_approach:
    summary: LocalBookmarkService class in src/features/storage/local-bookmark-service.js; TagService integration for tag tracking.
    details:
      - 'Default provider is local (ConfigManager getDefaultConfiguration().storageMode local)'
      - 'Storage key: hoverboard_local_bookmarks (object keyed by URL)'
      - Normalized bookmark shape matches PinboardService (url, description, extended, tags, time, shared, toread, hash)
      - trackBookmarkTags and extractTagsFromBookmarkData for recent-tag integration
  code_locations:
    files:
      - path: src/features/storage/local-bookmark-service.js
        description: LocalBookmarkService implementation
    functions: []
  traceability:
    architecture:
      - ARCH-LOCAL_STORAGE_PROVIDER
      - ARCH-STORAGE
    requirements:
      - REQ-STORAGE_MODE_DEFAULT
    tests: []
    code_annotations:
      - IMPL-LOCAL_BOOKMARK_SERVICE
  related_decisions:
    depends_on:
      - ARCH-LOCAL_STORAGE_PROVIDER
    supersedes: []
    see_also:
      - ARCH-STORAGE
    composed_with:
      - IMPL-BOOKMARK_ROUTER
      - IMPL-STORAGE_INDEX
  essence_pseudocode: |
    # [IMPL-LOCAL_BOOKMARK_SERVICE] [ARCH-LOCAL_STORAGE_PROVIDER] [ARCH-STORAGE] [REQ-STORAGE_MODE_DEFAULT]
    # chrome.storage.local bookmark provider; same contract as Pinboard; keyed by URL.
    # Contract: url/bookmark/tag inputs and provider-shaped outputs; storage key and shape.
    INPUT: url (string), bookmark data (for save), tag data (for saveTag/deleteTag), count (for getRecentBookmarks)
    OUTPUT: bookmark object or list of bookmarks or success/error; shape matches provider contract
    DATA: storage key = hoverboard_local_bookmarks; value = object keyed by normalized URL -> bookmark

    # Read from storage and return parsed object or {}.
    LOAD bookmarks:
      READ from storage under key
      RETURN parsed object (or {} if missing)

    # Lookup by normalized URL.
    getBookmarkForUrl(url):
      bookmarks = LOAD bookmarks
      urlNorm = normalize(url)
      RETURN bookmarks[urlNorm] or null

    # Merge data into bookmark shape and persist to storage.
    saveBookmark(data):
      bookmarks = LOAD bookmarks
      urlNorm = normalize(data.url)
      bookmarks[urlNorm] = merge(data into bookmark shape with url, description, extended, tags, time, shared, toread, hash)
      PERSIST bookmarks to storage under key
      RETURN { success: true }

    # Remove by normalized URL and persist.
    deleteBookmark(url):
      bookmarks = LOAD bookmarks
      REMOVE bookmarks[normalize(url)]
      PERSIST bookmarks to storage
      RETURN { success: true }

    # Update tags on bookmark and persist.
    saveTag(data), deleteTag(data):
      bookmark = getBookmarkForUrl(data.url); update tags; saveBookmark(bookmark) or equivalent
      RETURN { success: true }

    # Sort by time descending and return first count.
    getRecentBookmarks(count):
      bookmarks = LOAD bookmarks
      list = values(bookmarks)
      SORT list BY time DESCENDING
      RETURN list[0..count-1]
  detail_file: implementation-decisions/IMPL-LOCAL_BOOKMARK_SERVICE.yaml
  metadata:
    created:
      date: '2026-02-18'
      author: MCP converter
    last_updated:
      date: '2026-02-18'
      author: MCP converter
      reason: Converted from monolithic
    last_validated:
      date: '2026-02-18'
      validator: MCP converter
      result: pass
