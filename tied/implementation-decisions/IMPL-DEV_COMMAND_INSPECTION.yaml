IMPL-DEV_COMMAND_INSPECTION:
  name: DEV_COMMAND storage and router inspection
  status: Active
  cross_references:
    - REQ-UI_INSPECTION
    - REQ-URL_TAGS_DISPLAY
    - REQ-PER_BOOKMARK_STORAGE_BACKEND
  rationale:
    why: Tests and debug panel can read current bookmark, tags for URL, storage backend, and storage key list
    problems_solved:
      - Cannot inspect stored state without manual steps
    benefits:
      - processDevCommand in MessageHandler; getStorageSnapshot in SW when DEBUG_HOVERBOARD_UI set
  implementation_approach:
    summary: DEV_COMMAND subcommands getCurrentBookmark, getTagsForUrl, getStorageBackendForUrl (message-handler); getStorageSnapshot (service worker, returns key names only)
  code_locations:
    files:
      - path: src/core/message-handler.js
        description: processDevCommand
      - path: src/core/service-worker.js
        description: getStorageSnapshot
      - path: tests/utils/test-helpers.js
        description: Test helpers
    functions: []
  traceability:
    architecture: []
    requirements:
      - REQ-UI_INSPECTION
      - REQ-URL_TAGS_DISPLAY
      - REQ-PER_BOOKMARK_STORAGE_BACKEND
    tests: []
    code_annotations:
      - IMPL-DEV_COMMAND_INSPECTION
  related_decisions:
    depends_on: []
    supersedes: []
    see_also: []
    composed_with:
      - IMPL-DEBUG_PANEL
      - IMPL-MESSAGE_HANDLING
  essence_pseudocode: |
    INPUT: DEV_COMMAND message with subcommand (getCurrentBookmark | getTagsForUrl | getStorageBackendForUrl | getStorageSnapshot); optional url/context
    OUTPUT: current bookmark for URL, tags for URL, backend for URL, or storage key list (SW only); gated by DEBUG_HOVERBOARD_UI
    DATA: MessageHandler.processDevCommand; service worker getStorageSnapshot

    processDevCommand(cmd):
      IF subcommand getCurrentBookmark: RETURN bookmarkRouter.getBookmarkForUrl(url) or current tab url
      IF getTagsForUrl: RETURN tags for url
      IF getStorageBackendForUrl: RETURN storageIndex.getBackendForUrl(url)
      IF getStorageSnapshot (SW): RETURN list of storage key names only
  detail_file: implementation-decisions/IMPL-DEV_COMMAND_INSPECTION.yaml
  metadata:
    created:
      date: "2026-02-17"
      author: AI Agent
    last_updated:
      date: "2026-02-20"
      author: AI Agent
      reason: Add essence_pseudocode and complete composed_with
