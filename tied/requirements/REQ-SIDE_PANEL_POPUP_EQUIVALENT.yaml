# [REQ-SIDE_PANEL_POPUP_EQUIVALENT] Side panel popup equivalent with tabs
# Requirement: Side panel provides the same capabilities as the popup for the current tab's bookmark
# (quick actions, storage, tag management, search) and the existing tags tree, switchable via tabs.

REQ-SIDE_PANEL_POPUP_EQUIVALENT:
  name: Side Panel Popup Equivalent with Tabs
  category: Functional
  priority: P1
  status: Implemented
  rationale:
    why: Users can keep the side panel open and still manage the current tab's bookmark and browse the tags tree without reopening the popup.
    problems_solved:
      - Popup closes when focus is lost; no persistent popup-equivalent view
      - Side panel previously showed only the tags tree
    benefits:
      - One panel with tabs "Bookmark" and "Tags tree"; Bookmark tab = popup-equivalent UI; Tags tree tab = hierarchical view
      - User switches between Bookmark and Tags tree inside the same panel
  satisfaction_criteria:
    - criterion: Side panel has a tab bar with "Bookmark" and "Tags tree"
    - criterion: Bookmark tab shows functional equivalent of popup UI (quick actions, storage selector, tag management, search tabs, footer actions)
    - criterion: Tags tree tab shows the existing tags-and-bookmarks tree (config, search, tag selector, tree)
    - criterion: Only one tab content is visible at a time; switching tabs shows the corresponding panel
    - criterion: Last-selected tab is persisted and restored when the panel is reopened
    - criterion: In Bookmark tab, "Open Tags tree" (or equivalent) switches to the Tags tree tab instead of opening the panel again
    - criterion: When the Bookmark tab is selected, its content reflects the current tab's bookmark state; when the Bookmark tab is visible, it refreshes promptly when the active browser tab changes or the tab's page completes (like the badge)
    - criterion: When the side panel is open, both the Bookmark and Tags tree tabs update to display the DB record for the current tab's URL when the active browser tab changes or completes (same trigger as badge); the Tags tree tab's tag selector and tree reflect the current tab's bookmark tags
    - criterion: When the user switches to the Tags tree tab, the tag selector checked state matches the current bookmark's tags (from the Bookmark tab), and the tree displays only bookmarks that have at least one of those tags
    - criterion: Tab content fills the vertical space available in the side panel; the panel uses full panel width and height (not popup dimensions such as 350px width or 450px max-height)
  validation_criteria:
    - method: Manual verification
      coverage: Open panel; see tabs; switch to Bookmark, verify popup-equivalent UI and current-tab bookmark; switch to Tags tree, verify tree; close and reopen panel, verify last tab restored
    - method: Unit tests
      coverage: UIManager with scoped root (container) resolves elements from that root; tab switching shows/hides correct panel; tab persistence (mock storage)
    - method: E2E tests
      coverage: Open side panel; assert tabs present; switch tabs and assert correct content visible; assert panel layout fills vertical space (body not capped at popup max-height, content area flex)
  traceability:
    architecture:
      - ARCH-SIDE_PANEL_TABS
    implementation:
      - IMPL-SIDE_PANEL_TABS
      - IMPL-SIDE_PANEL_BOOKMARK
      - IMPL-UIManager_SCOPED_ROOT
    tests:
      - tests/unit/ui-manager-scoped-root.test.js
      - tests/unit/side-panel-tabs.test.js
      - tests/playwright/extension-messaging.spec.js
    code_annotations:
      - REQ-SIDE_PANEL_POPUP_EQUIVALENT
  related_requirements:
    depends_on: []
    related_to:
      - REQ-SIDE_PANEL_TAGS_TREE
      - REQ-AI_TAGGING_POPUP
    supersedes: []
  detail_file: requirements/REQ-SIDE_PANEL_POPUP_EQUIVALENT.yaml
  metadata:
    created:
      date: '2026-02-25'
      author: AI Agent
    last_updated:
      date: '2026-02-26'
      author: AI Agent
      reason: Add criterion that both Bookmark and Tags tree tabs update to current tab's URL when browser tab changes
