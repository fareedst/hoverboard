REQ-PER_BOOKMARK_STORAGE_BACKEND:
  name: Per-Bookmark Storage Backend
  category: Functional
  priority: P1
  status: Planned
  rationale:
    why: See detail file
    problems_solved: []
    benefits: []
  satisfaction_criteria:
    - criterion: 'Storage index: key `hoverboard_storage_index`, shape `{ "<url>": "pinboard"|"local"|"file" }`; getIndex, setBackendForUrl, getBackendForUrl, removeUrl.'
    - criterion: 'BookmarkRouter: getBookmarkForUrl, saveBookmark, deleteBookmark, saveTag, deleteTag use index or default; getRecentBookmarks aggregates all three, sorted by time.'
    - criterion: 'Migration: existing local bookmarks get index entry ''local''.'
  validation_criteria:
    - method: Manual verification
      coverage: See detail file
  traceability:
    architecture: []
    implementation: []
    tests: []
    code_annotations:
      - REQ-PER_BOOKMARK_STORAGE_BACKEND
  related_requirements:
    depends_on: []
    related_to: []
    supersedes: []
  detail_file: requirements/REQ-PER_BOOKMARK_STORAGE_BACKEND.yaml
  metadata:
    created:
      date: '2026-02-18'
      author: MCP converter
    last_updated:
      date: '2026-02-18'
      author: MCP converter
      reason: Converted from monolithic
    last_validated:
      date: '2026-02-18'
      validator: MCP converter
      result: pass
  cross-references: ARCH-STORAGE_INDEX_AND_ROUTER, IMPL-STORAGE_INDEX, IMPL-BOOKMARK_ROUTER
  purpose:
    - Allow mixing bookmarks across Pinboard, local browser storage, and file.
    - Enable moving a bookmark from one storage method to another (copy to target, delete from source, update index).
    - Default storage for new bookmarks from config (extended to include 'file').
  related:
    - ARCH-STORAGE_INDEX_AND_ROUTER, IMPL-STORAGE_INDEX, IMPL-BOOKMARK_ROUTER
    - REQ-MOVE_BOOKMARK_STORAGE_UI (move UI uses getStorageBackendForUrl and moveBookmarkToStorage)
  summary: 'Each bookmark is **tagged with a storage method**: `pinboard`, `local`, or `file`. A **storage index** (in chrome.storage.local) maps URL â†’ backend. A **BookmarkRouter** delegates get/save/delete to the correct provider per URL; new bookmarks use a **configurable default** backend when the URL is not in the index. getRecentBookmarks aggregates from all three providers.'
